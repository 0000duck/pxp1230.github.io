<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>GBK到UTF8编码转换C++实现 - </title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <style type="text/css">body{font:14px/200%"Hiragino Sans GB","Microsoft YaHei",tahoma,arial,simsun;color:#00CCFF;background:#1A1A1A;word-wrap:break-word;word-break:normal}img{max-width:100%}html,body,h1,h2,h3,h4,h5,h6,p,blockquote,ol,ul,li,img,li div{margin:0;padding:0;font:14px/200%"Hiragino Sans GB","Microsoft YaHei",tahoma,arial,simsun;line-height:22px;vertical-align:baseline;color:#00CCFF}body{margin:10px}p,div{margin-bottom:20px}strong{font-weight:bold}ol,ul{margin-left:2em;margin-bottom:20px}ul ul,ol ol,ul ol,ol ul{margin-top:10px}li{margin-bottom:10px}h1,h2,h3,h4,h5,h6{font-weight:lighter;text-transform:capitalize;margin-top:20px;margin-bottom:20px}h1{font-size:24.624px;line-height:29.548799999999996px}h2{font-size:24.624px;line-height:29.548799999999996px}h3{font-size:23.44px;line-height:28.128px}h4{font-size:22.16px;line-height:26.592px}h5{font-size:22.16px;line-height:26.592px}h6{font-size:22.16px;line-height:26.592px}img{margin-bottom:20px}h1 img,h2 img,h3 img,h4 img,h5 img,h6 img,p img{margin-bottom:0}pre{color:#00CCFF;margin-bottom:20px;white-space:pre;white-space:pre-wrap;word-wrap:break-word}code{font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace;font-size:12px;line-height:1.5;box-shadow:0 0 8px rgba(0,0,0,0.4);padding:2px 4px;color:#FC0;background-color:#232400;border:1px solid#333500;border-radius:3px}pre>code{padding:1em!important;border:none!important}h1{text-transform:uppercase;font-weight:bold;border-bottom:1px solid;padding-bottom:4px}h2{border-bottom:1px solid;padding-bottom:4px}h3,h4,h5,h6{border-bottom:none}html body{background-color:#1A1A1A}html h1,html h2,html h3,html h4,html h5,html h6{color:#FFCC00;border-color:#FFCC00}html a,html a:active,html a:visited{color:#FFCC00}html a:hover{background-color:#554400}html a,html a:active,html a:visited,html code.url{color:#FFCC00}html h2,html h3,html h4,html h5,html h6{color:#FFCC00}hr{border:0;background-color:#CC0000;height:4px;margin:40px auto}blockquote{background:#073642;border-left:10px solid#005266;margin:1.5em 10px;padding:.5em 10px}blockquote code{color:#00CCFF;font-family:"Hiragino Sans GB","Microsoft YaHei",tahoma,arial,simsun}blockquote pre{margin:0;padding:0}blockquote p,blockquote div{margin-bottom:0}strong{color:#FFCC00}</style>
  
  
  <meta charset="UTF-8"/>
  <meta name="author" content="潘霄鹏 - weibo.com/pxp1230">
  <meta name="keywords" content="潘霄鹏笔记">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  tex2jax: {inlineMath:[['$','$']],processEscapes:true}
  });
  </script>
  <script type="text/javascript"
  src="file:///storage/emulated/0/MathJax-master/MathJax-master/MathJax.js?config=TeX-AMS_HTML">
  </script>
  <script type="text/javascript"
  src="file:///C:/MathJax-master/MathJax-master/MathJax.js?config=TeX-AMS_HTML">
  </script>
  <link rel="stylesheet" href="file:///storage/emulated/0/highlight/styles/pojoaque.css">
  <script type="text/javascript"
  src="file:///storage/emulated/0/highlight/highlight.pack.js">
  </script>
  <link rel="stylesheet" href="file:///C:/highlight/styles/pojoaque.css">
  <script type="text/javascript"
  src="file:///C:/highlight/highlight.pack.js">
  </script>
  <script type="text/javascript">
  document.onkeydown=function(e){if(typeof(disableListenKeyDownEvent)=='undefined'){if(e.keyCode==88||e.keyCode==46){window.open('','_self');window.close()}else if(e.keyCode==8)window.open('index.html','_self')}}
  if(window.location.protocol!="file:"){var d=document,s=d.createElement('script');s.src='/pxp1230.github.io.js';(d.head||d.body).appendChild(s);}else{hljs.initHighlightingOnLoad();}
  </script>
</head>
<body>
<p>在stp2webgl.cxx中添加：</p>
<pre><code>//GBK到UTF8编码转换C++实现：http://blog.csdn.net/p569354158/article/details/6567175
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;windows.h&gt;
using namespace std;

string GBKToUTF8(const char* strGBK)
{
    string strOutUTF8 = &quot;&quot;;
    wchar_t * str1;
    int n = MultiByteToWideChar(CP_ACP, 0, strGBK, -1, NULL, 0);
    str1 = new wchar_t[n];
    MultiByteToWideChar(CP_ACP, 0, strGBK, -1, str1, n);
    n = WideCharToMultiByte(CP_UTF8, 0, str1, -1, NULL, 0, NULL, NULL);
    char * str2 = new char[n];
    WideCharToMultiByte(CP_UTF8, 0, str1, -1, str2, n, NULL, NULL);
    strOutUTF8 = str2;
    delete[]str1;
    str1 = NULL;
    delete[]str2;
    str2 = NULL;
    return strOutUTF8;
}</code></pre>
<p>并修改：</p>
<pre><code>// Read the step file

opts.design = ROSE.findDesign(opts.srcfile);</code></pre>
<p>为</p>
<pre><code>// Read the step file

opts.design = ROSE.findDesign(GBKToUTF8(opts.srcfile).c_str());</code></pre>
<p>资料来源：<a href="http://blog.csdn.net/p569354158/article/details/6567175" class="uri">http://blog.csdn.net/p569354158/article/details/6567175</a></p>
<pre><code>#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;fstream&gt;
#include &lt;windows.h&gt; 

using namespace std;

string GBKToUTF8(const std::string&amp; strGBK)
{
    string strOutUTF8 = &quot;&quot;;
    WCHAR * str1;
    int n = MultiByteToWideChar(CP_ACP, 0, strGBK.c_str(), -1, NULL, 0);
    str1 = new WCHAR[n];
    MultiByteToWideChar(CP_ACP, 0, strGBK.c_str(), -1, str1, n);
    n = WideCharToMultiByte(CP_UTF8, 0, str1, -1, NULL, 0, NULL, NULL);
    char * str2 = new char[n];
    WideCharToMultiByte(CP_UTF8, 0, str1, -1, str2, n, NULL, NULL);
    strOutUTF8 = str2;
    delete[]str1;
    str1 = NULL;
    delete[]str2;
    str2 = NULL;
    return strOutUTF8;
}

string UTF8ToGBK(const std::string&amp; strUTF8)
{
    int len = MultiByteToWideChar(CP_UTF8, 0, strUTF8.c_str(), -1, NULL, 0);
    unsigned short * wszGBK = new unsigned short[len + 1];
    memset(wszGBK, 0, len * 2 + 2);
    MultiByteToWideChar(CP_UTF8, 0, (LPCTSTR)strUTF8.c_str(), -1, wszGBK, len);

    len = WideCharToMultiByte(CP_ACP, 0, wszGBK, -1, NULL, 0, NULL, NULL);
    char *szGBK = new char[len + 1];
    memset(szGBK, 0, len + 1);
    WideCharToMultiByte(CP_ACP,0, wszGBK, -1, szGBK, len, NULL, NULL);
    //strUTF8 = szGBK;
    std::string strTemp(szGBK);
    delete[]szGBK;
    delete[]wszGBK;
    return strTemp;
}

int _tmain(int argc, _TCHAR* argv[])
{
    string test(&quot;我们中国是个强大的名族，强大的动力来自每个人的支持&quot;);
    fstream output(&quot;test.txt&quot;,ios_base::out | ios_base::app);
    output &lt;&lt; GBKToUTF8(test);
    //system(&quot;iconv -f GBK -t utf-8&quot;);
    return 0;
}</code></pre>
</body>
</html>
