## 从一个模型复制材质到另一个模型 ##

	using UnityEngine;
	using System.Collections;
	using UnityEditor;
	
	public class DoCopyMaterials : ScriptableObject
	{
	    [MenuItem("GameObject/从一个模型复制材质到另一个模型")]
	    static public void DoCopy()
	    {
	        if (Selection.gameObjects.Length == 2)
	        {
	            from = Selection.activeGameObject.transform;
	            to = Selection.gameObjects[Selection.activeGameObject == Selection.gameObjects[0] ? 1 : 0].transform;
	            from_m = from.worldToLocalMatrix;
	            to_m = to.worldToLocalMatrix;
	            Debug.Log("开始复制材质： " + from.name + " => " + to.name);
	            CopyMaterials();
	        }
	        else
	        {
	            EditorUtility.DisplayDialog("失败", "第一步、先把两个模型放在同一层级\n第二步、按顺序选中这两个模型", "确定");
	        }
	    }
	
	    static Transform from;
	    static Transform to;
	    static Matrix4x4 from_m;
	    static Matrix4x4 to_m;
	    static void CopyMaterials()
	    {
	        MeshRenderer[] renderers = from.GetComponentsInChildren<MeshRenderer>();
	        Debug.Log("执行完毕，材质复制个数：" + renderers.Length);
	        foreach (MeshRenderer renderer in renderers)
	        {
	            Bounds from_b = renderer.bounds;
	            from_b = new Bounds(from_m.MultiplyPoint(from_b.center), from_m.MultiplyVector(from_b.size));
	            MeshRenderer r = FindMesh(to, from_b, renderer.name);
	            if (r)
	            {
	                //Debug.Log("复制成功:" + renderer.name + "=>" + r.name + "\t" + renderer.sharedMaterial.name + "=>" + r.sharedMaterial);
	                r.sharedMaterial = renderer.sharedMaterial;
	            }
	
	        }
	    }
	
	    static MeshRenderer FindMesh(Transform to, Bounds from_b, string from_name)
	    {
	        MeshRenderer ret = null;
	        foreach (Transform item in to)
	        {
	            MeshRenderer m = item.GetComponent<MeshRenderer>();
	            if (m)
	            {
	                Bounds to_b = m.bounds;
	                to_b = new Bounds(to_m.MultiplyPoint(to_b.center), to_m.MultiplyVector(to_b.size));
	                if (from_b.size == to_b.size && from_b.center == to_b.center)
	                //if (from_name == item.name)
	                {
	                    ret = m;
	                    return ret;
	                }
	                else
	                {
	                    ret = FindMesh(item, from_b, from_name);
	                    if (ret)
	                        return ret;
	                }
	            }
	            else
	            {
	                ret = FindMesh(item, from_b, from_name);
	                if (ret)
	                    return ret;
	            }
	        }
	        return ret;
	    }
	}
