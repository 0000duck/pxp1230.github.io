<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>集群渲染 - </title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <style type="text/css">
  h1,h2,h3,h4,h5,h6,p,div,blockquote,ol,ul,li,img,li div{font-size:14px;font-family:"Hiragino Sans GB","Microsoft YaHei",tahoma,arial,simsun;line-height:21px;vertical-align:baseline;color:#0CF;word-wrap:break-word;word-break:normal;margin:0 0 10px;padding:0;}body{background-color:#1A1A1A;margin:10px;}embed,img{max-width:100%;margin:5px auto 0;}embed{margin:5px auto;}strong,em{color:#C0F;}ol,ul{margin:0 0 10px 2em;}ul ul,ol ol,ul ol,ol ul{margin:0 0 5px 2em;}li{margin-bottom:5px;}h1,h2,h3,h4,h5,h6{color:#FC0;border-color:#FC0;margin:20px 0 10px;}h1{margin-top:80px;font-size:28px;line-height:32px;border-bottom:2px solid;padding-bottom:0;}h2{font-size:24px;line-height:28px;}h3{font-size:22px;line-height:26px;}h4{font-size:20px;line-height:24px;}h5{font-size:18px;line-height:22px;}h6{font-size:16px;line-height:20px;}code{font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace;font-size:12px;line-height:1.5;box-shadow:0 0 8px rgba(0,0,0,0.4);color:#C0F;background-color:#510065;border:1px solid #C0F;border-radius:3px;word-wrap:normal;padding:0 4px;}pre{display:inline-block;margin:0 0 10px;min-width: 100%;}pre>code{border:none!important;padding:5px 10px!important;}a,a:active,a:visited{font-weight:bold;color:#C0F;}a:hover{background-color:#510065;}hr{border-top:1px dashed #0CF;border-width:0;margin:10px;}blockquote{background-color:#005266;border-left:5px solid #0CF;border-radius:3px;padding:5px 10px;}blockquote p{margin:0;}
  </style>
  
  
  <meta charset="UTF-8"/>
  <meta name="author" content="潘霄鹏 - weibo.com/pxp1230">
  <meta name="keywords" content="潘霄鹏笔记">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  tex2jax: {inlineMath:[['$','$']],processEscapes:true}
  });
  </script>
  <script type="text/javascript" src="file:///storage/emulated/0/MathJax-master/MathJax-master/MathJax.js?config=TeX-AMS_HTML"></script>
  <script type="text/javascript" src="file:///C:/MathJax-master/MathJax-master/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="file:///storage/emulated/0/highlight/styles/pojoaque.css">
  <script type="text/javascript" src="file:///storage/emulated/0/highlight/highlight.pack.js"></script>
  <link rel="stylesheet" href="file:///C:/highlight/styles/pojoaque.css">
  <script type="text/javascript" src="file:///C:/highlight/highlight.pack.js"></script>
  <script type="text/javascript" src="file:///storage/emulated/0/pxp1230.github.io.js"></script>
  <script type="text/javascript" src="file:///C:/pxp1230.github.io.js"></script>
  <script type="text/javascript">
  if(window.location.protocol!="file:"){var d=document,s=d.createElement('script');s.src='/pxp1230.github.io.js';d.head.appendChild(s);}
  </script>
</head>
<body>
<h1>集群渲染概述</h1>
<p>Unity的集群渲染技术允许多台主机同时同步地渲染同一个场景，该特性使你能将项目部署到多屏环境中，例如视频墙、CAVE等。</p>
<p>Unity的集群渲染技术可容纳非常多的显示设备，如果网络带宽足够的话，可以支持50个屏幕以上。</p>
<p>这项技术需要在所有主机中安装并运行同一个项目工程可执行文件，所有主机必须处于同一个局域网中。</p>
<h1>硬件设置</h1>
<p>一个节点由一台工作站和一个显示器组成，每台工作站运行同一个可执行文件（开启Cluster Rendering）。</p>
<p>下图中有一个主节点和客户端节点。客户端节点通过局域网和主节点相连。一般使用高带宽的网线连接，WiFi的速度一般不能达到要求，会导致同步不一致。<br />
<img src="集群渲染_files/ClusterRenderingDiagram.png" alt="" /></p>
<h1>原理</h1>
<p>要开启一个Cluster Rendering组，你需要通过命令行配置每一个节点的主从关系。</p>
<p>主节点会自动同步所有客户端节点，该方法被称作帧锁定。这意味着主节点会传播一个“update”信号给所有客户端主机在它自己的Update()中，当客户端节点“checked in”主节点时。一旦主节点发出“update”信号，它会等待直到所有客户端节点返回“checked in”信号，然后继续该循环。</p>
<p>主节点也可以发送长数据，例如时间、随机数种子、外设输入值。这能确保所有主机的运行效果都一致。信息同步的效率和场景复杂度无关，这意味着一个复杂的场景不会影响网络性能，只会影响单个节点的渲染性能。</p>
<h1 id="unity">部署一个Unity集群</h1>
<p>以Unity Cluster模式运行可执行文件：</p>
<p><strong>Master node</strong></p>
<pre><code>-server &lt;number of clients&gt; *:&lt;pubport&gt; *:* &lt;timeout&gt;</code></pre>
<ul>
<li>number of clients 参数：客户端节点数量，不包括主节点。直到连接的客户端主机达到这个数量，主节点才会真正开始运行。</li>
<li>timeout 参数：可选，用于判断等待信号的最大时长，超过这个时间就判定为连接断开。</li>
</ul>
<p><strong>Client node</strong></p>
<pre><code>-client &lt;index&gt; &lt;masterip&gt;:&lt;pubport&gt; &lt;clientip&gt;:&lt;clientport&gt; &lt;timeout&gt;</code></pre>
<ul>
<li>index 参数：客户端节点唯一标识符。</li>
<li>masterip 和 pubport 参数：主节点的IP地址和端口号，不要使用localhost，它会产生错误。</li>
<li>clientip 和 clientport 参数：客户端节点的IP地址和端口号，一般使用*代替：<code>*:*</code></li>
<li>timeout 参数：可选，用于判断等待信号的最大时长，超过这个时间就判定为连接断开。</li>
</ul>
</body>
</html>
